<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jadwal Sholat - API MyQuran</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">

    <!-- Navbar -->
    <nav class="bg-blue-600 text-white py-4 text-center text-lg font-semibold">
        Jadwal Sholat Indonesia
    </nav>

    <!-- Container -->
    <div class="max-w-lg mx-auto p-4">

        <!-- Form Pencarian Kota -->
        <div class="bg-white p-4 rounded-lg shadow-md text-center">
            <h2 class="text-xl font-bold text-gray-700">Masukkan Nama Kota</h2>
            <input id="search" type="text" placeholder="Contoh: Jakarta, Bandung..." 
                   class="w-full p-2 mt-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
            <button onclick="cariKota()" 
                    class="mt-3 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                Cari Kota
            </button>
        </div>

        <!-- Hasil Pencarian Kota -->
        <div id="hasilKota" class="bg-white p-4 rounded-lg shadow-md text-center hidden mt-4">
            <h2 class="text-lg font-semibold text-gray-700">Detail Kota</h2>
            <p class="mt-2 text-gray-600"><strong>ID Kota:</strong> <span id="idKota"></span></p>
            <p class="mt-2 text-gray-600"><strong>Nama Kota:</strong> <span id="namaKota"></span></p>

            <button onclick="getJadwal()" 
                    class="mt-3 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                Tampilkan Jadwal Sholat
            </button>
        </div>

        <!-- Jadwal Sholat -->
        <div id="jadwalSholat" class="bg-white p-4 rounded-lg shadow-md hidden mt-4">
            <h2 class="text-lg font-semibold text-gray-700 text-center">Jadwal Sholat</h2>
            <div class="overflow-x-auto">
                <table class="w-full mt-3 border border-gray-300 text-sm sm:text-base">
                    <thead class="bg-green-600 text-white">
                        <tr>
                            <th class="border p-2">Tanggal</th>
                            <th class="border p-2">Imsak</th>
                            <th class="border p-2">Subuh</th>
                            <th class="border p-2">Dzuhur</th>
                            <th class="border p-2">Ashar</th>
                            <th class="border p-2">Maghrib</th>
                            <th class="border p-2">Isya</th>
                        </tr>
                    </thead>
                    <tbody id="jadwalBody"></tbody>
                </table>
            </div>
        </div>

    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white text-center py-3 mt-5 text-sm">
        &copy; 2025 Jadwal Sholat Indonesia
    </footer>

    <!-- Script Fetch API -->
    <script>
        let idKota = "";

        function cariKota() {
            let query = document.getElementById("search").value.trim();
            if (query === "") {
                alert("Masukkan nama kota terlebih dahulu!");
                return;
            }

            fetch(`https://api.myquran.com/v2/sholat/kota/cari/${query}`)
                .then(response => response.json())
                .then(data => {
                    if (data.status && data.data.length > 0) {
                        let kota = data.data[0]; // Ambil hasil pertama
                        idKota = kota.id; // Simpan ID Kota

                        document.getElementById("idKota").innerText = kota.id;
                        document.getElementById("namaKota").innerText = kota.lokasi;

                        document.getElementById("hasilKota").classList.remove("hidden");
                    } else {
                        alert("Kota tidak ditemukan! Coba masukkan kota lain.");
                    }
                })
                .catch(error => console.error("Error:", error));
        }

        function getJadwal() {
            if (idKota === "") {
                alert("Cari kota terlebih dahulu!");
                return;
            }

            let tanggal = new Date();
            let tahun = tanggal.getFullYear();
            let bulan = ("0" + (tanggal.getMonth() + 1)).slice(-2); // Format 2 digit bulan
            let hari = ("0" + tanggal.getDate()).slice(-2); // Format 2 digit hari
            let hariIni = `${hari}/${bulan}/${tahun}`; // Format yang sesuai dengan API

            fetch(`https://api.myquran.com/v2/sholat/jadwal/${idKota}/${tahun}/${bulan}`)
                .then(response => response.json())
                .then(data => {
                    if (data.status) {
                        let jadwal = data.data.jadwal;
                        let jadwalBody = document.getElementById("jadwalBody");
                        jadwalBody.innerHTML = "";

                        jadwal.forEach(hari => {
                            let highlight = hari.tanggal === hariIni ? "bg-green-200 font-bold" : ""; 

                            let row = `
                                <tr class="text-center ${highlight}">
                                    <td class="border p-2">${hari.tanggal}</td>
                                    <td class="border p-2">${hari.imsak}</td>
                                    <td class="border p-2">${hari.subuh}</td>
                                    <td class="border p-2">${hari.dzuhur}</td>
                                    <td class="border p-2">${hari.ashar}</td>
                                    <td class="border p-2">${hari.maghrib}</td>
                                    <td class="border p-2">${hari.isya}</td>
                                </tr>
                            `;
                            jadwalBody.innerHTML += row;
                        });

                        document.getElementById("jadwalSholat").classList.remove("hidden");
                    } else {
                        alert("Jadwal sholat tidak ditemukan!");
                    }
                })
                .catch(error => console.error("Error:", error));
        }
    </script>

</body>
</html>